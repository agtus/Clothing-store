<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel - Multi Image Upload</title>
  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 2rem; }
    h1, h2 { text-align: center; }
    form {
      max-width: 600px; margin: 1rem auto; background: white;
      padding: 1.5rem; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label { display: block; margin-top: 1rem; }
    input, textarea, select {
      width: 100%; padding: 0.6rem; margin-top: 0.3rem;
      border-radius: 5px; border: 1px solid #ccc;
    }
    button {
      margin-top: 1rem; padding: 0.7rem 1.2rem; background: #000;
      color: white; border: none; border-radius: 5px; cursor: pointer;
    }
    .message { text-align: center; margin-top: 1rem; font-weight: bold; }
    .image-preview {
      display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;
    }
    .image-preview img {
      height: 100px; border-radius: 5px; object-fit: cover;
    }
  </style>
</head>
<body>
  <h1>üõ†Ô∏è Admin Panel</h1>

  <form id="addForm">
    <h2>Add Product</h2>
    <label>ID</label><input type="text" name="id" required />
    <label>Name</label><input type="text" name="name" required />
    <label>Price (‚Çπ)</label><input type="text" name="price" required />
    <label>Amount (Paise)</label><input type="text" name="amount" required />
    <label>Upload Images</label>
    <input type="file" name="images" id="images" accept="image/*" multiple />
    <div class="image-preview" id="preview"></div>
    <label>Description</label><textarea name="desc" required></textarea>
    <label>Trending</label>
    <select name="trending">
      <option value="Yes">Yes</option>
      <option value="No">No</option>
    </select>
    <label>Section</label>
    <select name="section">
      <option value="Women">Women</option>
      <option value="Bedsheets">Bedsheets</option>
      <option value="Raw Materials">Raw Materials</option>
      <option value="Home Decors">Home Decors</option>
    </select>
    <button type="submit">Add Product</button>
    <div class="message" id="addMsg"></div>
  </form>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyiXDj4PgyXTRaZWE-DNiuqxxrazPOb4wh2BeDQvXgtalvjGX2v8vgsQSApGVXIP-fo/exec";
    const cloudName = "dxwvqo37k";
    const uploadPreset = "unsigned_preset";

    const form = document.getElementById("addForm");
    const imageInput = document.getElementById("images");
    const preview = document.getElementById("preview");
    let uploadedImageURLs = [];

    // Preview selected images
    imageInput.addEventListener("change", () => {
      preview.innerHTML = "";
      uploadedImageURLs = [];
      [...imageInput.files].forEach(file => {
        const reader = new FileReader();
        reader.onload = () => {
          const img = document.createElement("img");
          img.src = reader.result;
          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    });

    // Upload images to Cloudinary
    async function uploadImages() {
      const files = imageInput.files;
      const urls = [];

      for (let file of files) {
        const formData = new FormData();
        formData.append("file", file);
        formData.append("upload_preset", uploadPreset);

        const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
          method: "POST",
          body: formData
        });

        const data = await res.json();
        urls.push(data.secure_url);
      }

      return urls;
    }

    form.addEventListener("submit", async function(e) {
      e.preventDefault();
      document.getElementById("addMsg").innerText = "Uploading images...";

      const imageURLs = await uploadImages();

      const formData = new FormData(form);
      formData.append("image", imageURLs.join(","));
      formData.append("action", "add");

      const res = await fetch(scriptURL, {
        method: "POST",
        body: new URLSearchParams(formData)
      });

      const msg = await res.text();
      document.getElementById("addMsg").innerText = msg === "Added" ? "‚úÖ Product added!" : "‚ùå Error";

      if (msg === "Added") {
        form.reset();
        preview.innerHTML = "";
        uploadedImageURLs = [];
      }
    });
  </script>
</body>
</html>
